<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; PhenomeDB 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="phenomedb.task" href="task.html" />
    <link rel="prev" title="phenomedb.pipelines" href="pipelines.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PhenomeDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#settings">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">phenomedb.analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_correction.html">phenomedb.batch_correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_view.html">phenomedb.base_view</a></li>
<li class="toctree-l1"><a class="reference internal" href="cache.html">phenomedb.cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="compounds.html">phenomedb.compounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="imports.html">phenomedb.imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">phenomedb.metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">phenomedb.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline_factory.html">phenomedb.pipeline_factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">phenomedb.pipelines</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">MetadataFilter</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="#phenomedb.query_factory.ProjectRoleFilter"><code class="docutils literal notranslate"><span class="pre">ProjectRoleFilter</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory"><code class="docutils literal notranslate"><span class="pre">QueryFactory</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.add_filter"><code class="docutils literal notranslate"><span class="pre">QueryFactory.add_filter()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_comparison_operation"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_comparison_operation()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_filter_string"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_filter_string()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_function_operation"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_function_operation()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_intensity_data_sample_metadata_and_feature_metadata"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_intensity_data_sample_metadata_and_feature_metadata()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_logical_operator"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_logical_operator()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_match_string"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_match_string()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_match_value"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_match_value()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_model_property_name"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_model_property_name()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_query_string"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_query_string()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.build_sub_filter_string"><code class="docutils literal notranslate"><span class="pre">QueryFactory.build_sub_filter_string()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.calculate_joins"><code class="docutils literal notranslate"><span class="pre">QueryFactory.calculate_joins()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.calculate_summary_statistics"><code class="docutils literal notranslate"><span class="pre">QueryFactory.calculate_summary_statistics()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.delete_cache"><code class="docutils literal notranslate"><span class="pre">QueryFactory.delete_cache()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.execute_and_build_dataframe"><code class="docutils literal notranslate"><span class="pre">QueryFactory.execute_and_build_dataframe()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.execute_query"><code class="docutils literal notranslate"><span class="pre">QueryFactory.execute_query()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.generate_and_execute_query"><code class="docutils literal notranslate"><span class="pre">QueryFactory.generate_and_execute_query()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.generate_query"><code class="docutils literal notranslate"><span class="pre">QueryFactory.generate_query()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.get_code_string"><code class="docutils literal notranslate"><span class="pre">QueryFactory.get_code_string()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.get_dataframe_key"><code class="docutils literal notranslate"><span class="pre">QueryFactory.get_dataframe_key()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.get_query_rows"><code class="docutils literal notranslate"><span class="pre">QueryFactory.get_query_rows()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.get_unique_match_models"><code class="docutils literal notranslate"><span class="pre">QueryFactory.get_unique_match_models()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.load_dataframe"><code class="docutils literal notranslate"><span class="pre">QueryFactory.load_dataframe()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.save_query"><code class="docutils literal notranslate"><span class="pre">QueryFactory.save_query()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFactory.set_db_session"><code class="docutils literal notranslate"><span class="pre">QueryFactory.set_db_session()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#phenomedb.query_factory.QueryFilter"><code class="docutils literal notranslate"><span class="pre">QueryFilter</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFilter.add_match"><code class="docutils literal notranslate"><span class="pre">QueryFilter.add_match()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFilter.add_sub_filter"><code class="docutils literal notranslate"><span class="pre">QueryFilter.add_sub_filter()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryFilter.get_filter_dict"><code class="docutils literal notranslate"><span class="pre">QueryFilter.get_filter_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#phenomedb.query_factory.QueryMatch"><code class="docutils literal notranslate"><span class="pre">QueryMatch</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QueryMatch.get_match_dict"><code class="docutils literal notranslate"><span class="pre">QueryMatch.get_match_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#phenomedb.query_factory.QuerySubFilter"><code class="docutils literal notranslate"><span class="pre">QuerySubFilter</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QuerySubFilter.add_match"><code class="docutils literal notranslate"><span class="pre">QuerySubFilter.add_match()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#phenomedb.query_factory.QuerySubFilter.get_sub_filter_dict"><code class="docutils literal notranslate"><span class="pre">QuerySubFilter.get_sub_filter_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="task.html">phenomedb.task</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">phenomedb.utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="views.html">phenomedb.views</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PhenomeDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/query_factory.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="highlight-pythonphenomedb.query_factory notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<hr class="docutils" />
<p>Creating queries can be done either via the Query Factory view or the QueryFactory Python API. In PhenomeDB Queries are created by chaining QueryFilter objects containing boolean operators and QueryMatches, which specifying the fields and comparison operators and values. An overview of this can be seen below. With the collection of QueryFilters and QueryMatches, the QueryFactory then calculates/transpiles the query definition into an SQLAlchemy query, and executes the query. The QueryFactory can then construct a combined-format and 3-file format dataset of the results, and store them in the PhenomeDB Cache, an extended version of Redis that enables file-system persistency of objects. Generating the dataframes can currently take a long time depending on the number of records the query returns, for this reason once the query has been defined the user should run the CreateSavedQueryDataframeCache task to execute the query and set it into the cache. This can be run manually via the interface or via the QueryFactory UI.</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/query-filters-overview.png"><img alt="PhenomeDB QueryFactory QueryFilters and QueryMatches" src="_images/query-filters-overview.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">The QueryFilter and QueryMatch architecture. Multiple QueryFilters can be added, each with AND or OR boolean operators. Each QueryFilter can have multiple QueryMatches, targeting a specific Model.property, with a specific comparison operator and value.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>An example of using these to construct a query is shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate the QueryFactory</span>
<span class="n">query_factory</span> <span class="o">=</span> <span class="n">QueryFactory</span><span class="p">(</span><span class="n">query_name</span><span class="o">=</span><span class="s1">&#39;Users under 40&#39;</span><span class="p">,</span> <span class="n">query_description</span><span class="o">=</span><span class="s1">&#39;test description&#39;</span><span class="p">)</span>

<span class="c1"># Add a filter with the match properties added in the constructor (default &#39;AND&#39;)</span>
<span class="n">query_factory</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;My Project&#39;</span><span class="p">)</span>

<span class="c1"># Create another filter with the match properties added in the constructor</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="n">QueryFilter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;HarmonisedMetadataField&#39;</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">operator</span><span class="o">=</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>

<span class="c1"># Add another match to the filter</span>
<span class="nb">filter</span><span class="o">.</span><span class="n">add_match</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;MetadataValue&#39;</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;harmonised numeric value&#39;</span><span class="p">,</span><span class="n">operator</span><span class="o">=</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="c1"># Add the filter to the query factory (default &#39;AND&#39;)</span>
<span class="n">query_factory</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">query_filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>

<span class="c1">#4. Save the query in the SavedQuery data model</span>
<span class="n">query_factory</span><span class="o">.</span><span class="n">save_query</span><span class="p">()</span>

<span class="c1">#5. Generate the summary statistics</span>
<span class="n">query_factory</span><span class="o">.</span><span class="n">calculate_summary_statistics</span><span class="p">()</span>

<span class="c1">#6. Execute the query, build the 3-file format, load into cache, and return dataframes</span>
<span class="n">intensity_data</span> <span class="o">=</span> <span class="n">query_factory</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="s1">&#39;intensity_data&#39;</span><span class="p">,</span><span class="n">harmonise_annotations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sample_metadata</span> <span class="o">=</span> <span class="n">query_factory</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="s1">&#39;sample_metadata&#39;</span><span class="p">,</span><span class="n">harmonise_annotations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feature_metadata</span> <span class="o">=</span> <span class="n">query_factory</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="s1">&#39;feature_metadata&#39;</span><span class="p">,</span><span class="n">harmonise_annotations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To simplify querying HarmonisedMetadataFields, the following MetadataFilter can be used</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate the QueryFactory</span>
<span class="n">query</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">QueryFactory</span><span class="p">(</span><span class="n">query_name</span><span class="o">=</span><span class="s1">&#39;Users under 40&#39;</span><span class="p">,</span> <span class="n">query_description</span><span class="o">=</span><span class="s1">&#39;test description&#39;</span><span class="p">)</span>

<span class="c1"># Add a filter with the match properties added in the constructor (default &#39;AND&#39;)</span>
<span class="n">query</span> <span class="n">factory</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">QueryFilter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">operator</span><span class="o">=</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;My Project&#39;</span><span class="p">))</span>

<span class="c1"># Add a Metadata filter with the match properties added in the constructor (default &#39;AND&#39;)</span>
<span class="n">query</span> <span class="n">factory</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">MetadataFilter</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mi">40</span><span class="p">))</span>

<span class="c1">#4. Save the query in the SavedQuery data model</span>
<span class="n">query</span> <span class="n">factory</span><span class="o">.</span><span class="n">save_query</span><span class="p">()</span>

<span class="c1">#5. Generate the summary statistics</span>
<span class="n">query_factory</span><span class="o">.</span><span class="n">calculate_summary_statistics</span><span class="p">()</span>

<span class="c1">#6. Execute the query, build the 3-file format, load into cache, and return dataframes</span>
<span class="n">intensity_data</span> <span class="o">=</span> <span class="n">query_factory</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="s1">&#39;intensity_data&#39;</span><span class="p">,</span><span class="n">harmonise_annotations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sample_metadata</span> <span class="o">=</span> <span class="n">query_factory</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="s1">&#39;sample_metadata&#39;</span><span class="p">,</span><span class="n">harmonise_annotations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feature_metadata</span> <span class="o">=</span> <span class="n">query_factory</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="s1">&#39;feature_metadata&#39;</span><span class="p">,</span><span class="n">harmonise_annotations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>SavedQueries can be created and explored using the QueryFactory user interface. Through the interface the summary statistics for the query can be visually explored to assess the composition of the generated cohort. Once you are happy with the composition you should then execute the CreateSavedQueryDataframeCache task for the SavedQuery to build the query dataframes and store them in the Cache.</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="_images/query-ui-create.png"><img alt="PhenomeDB QueryFactory UI create" src="_images/query-ui-create.png" style="width: 650px;" /></a>
<figcaption>
<p><span class="caption-text">Creating a SavedQuery using the UI.</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/query-summary-stats-example.png"><img alt="PhenomeDB QueryFactory summary stats" src="_images/query-summary-stats-example.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">The QueryFactory summary stats output.</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id4">
<a class="reference internal image-reference" href="_images/query-ui-generate-cache-buttons.png"><img alt="PhenomeDB generate cache" src="_images/query-ui-generate-cache-buttons.png" style="width: 650px;" /></a>
<figcaption>
<p><span class="caption-text">Buttons to trigger a CreateSavedQueryDataframe task via the QueryFactory UI</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id5">
<a class="reference internal image-reference" href="_images/query-ui-download-dataframe.png"><img alt="PhenomeDB QueryFactory download options" src="_images/query-ui-download-dataframe.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">QueryFactory options for downloading a dataframe. Options include the ability to bin harmonised metadata fields, include or exclude specific columns, and specify the output format.</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Query dict structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="nb">str</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span> <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                              <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                              <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                              <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                              <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span>
                                          <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>query_dict[‘model’]: The model object to return
query_dict[‘joins’]: The list of models to join
query_dict[‘filters’] : The list of ‘filters’.
query_dict[‘filters’][‘filter_operator]: The type of filter - ‘AND’, ‘OR’
query_dict[‘filters’][‘matches’]: A list of ‘matches’
query_dict[‘filters’][‘matches’][‘model’]: The name of the model to match against.
query_dict[‘filters’][‘matches’][‘property’]: The name of the property to match against.
query_dict[‘filters’][‘matches’][‘operator’]: The operator to use - ‘eq’,’not_eq’,’gt’,’lt’,’gte’,’lte’,’between’,’not_between’,’in’,’not_in’,’like’,’not_like’,’ilike’,’not_ilike’
query_dict[‘filters’][‘matches’][‘value’]: The value to match on. Must be of expected type - ie str, float, [0,1] (for between) or [0,N] (for in or in)</p>
<p>Example usage:</p>
<p>Creating and saving new query with the following structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span><span class="s1">&#39;MetadataValue&#39;</span><span class="p">,</span><span class="s1">&#39;MetadataField&#39;</span><span class="p">,</span><span class="s1">&#39;HarmonisedMetadataField&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Project&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;property&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PipelineTesting&#39;</span><span class="p">,</span>
                    <span class="p">}]</span>
                <span class="p">},{</span>
                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;HarmonisedMetadataField&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                        <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;MetadataValue&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;harmonised_numeric_value&#39;</span><span class="p">,</span>
                        <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;30&quot;</span><span class="p">,</span><span class="s2">&quot;35&quot;</span><span class="p">,</span><span class="s2">&quot;40&quot;</span><span class="p">]</span>
                    <span class="p">}]</span>
                <span class="p">}]</span>
              <span class="p">}</span>

<span class="n">query_factory</span> <span class="o">=</span> <span class="n">CohortQuery</span><span class="p">()</span>

<span class="nb">filter</span> <span class="o">=</span> <span class="n">QueryFilter</span><span class="p">(</span><span class="n">filter_operator</span><span class="o">=</span><span class="s1">&#39;AND&#39;</span><span class="p">)</span>
<span class="nb">filter</span><span class="o">.</span><span class="n">add_match</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">operator</span><span class="o">=</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;PipelineTesting&#39;</span><span class="p">)</span>
<span class="n">query_factory</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">query_filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>

<span class="nb">filter</span> <span class="o">=</span> <span class="n">QueryFilter</span><span class="p">(</span><span class="n">filter_operator</span><span class="o">=</span><span class="s1">&#39;AND&#39;</span><span class="p">)</span>
<span class="nb">filter</span><span class="o">.</span><span class="n">add_match</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;HarmonisedMetadataField&#39;</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">operator</span><span class="o">=</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>
<span class="nb">filter</span><span class="o">.</span><span class="n">add_match</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;MetadataValue&#39;</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;harmonised_numeric_value&#39;</span><span class="p">,</span><span class="n">operator</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">])</span>
<span class="n">query_factory</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">query_filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">query_factory</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">query_retrieved_from_db</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">CohortQuery</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CohortQuery</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">query</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">query_factory_retrieved</span> <span class="o">=</span> <span class="n">CohortQuery</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query_retrieved_from_db</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">query_factory_retrieved</span><span class="o">.</span><span class="n">get_query_rows</span><span class="p">()</span>
</pre></div>
</div>
<p>Example queries and query_dicts:</p>
<p>All Samples from PipelineTesting project</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span><span class="n">Project</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Project</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;PipelineTesting&#39;</span><span class="p">)</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span><span class="s1">&#39;Project&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Project&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PipelineTesting&#39;</span><span class="p">,</span>
                                        <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All from every project NOT PipelineTesting</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span><span class="n">Project</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Project</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;PipelineTesting&#39;</span><span class="p">)</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span><span class="s1">&#39;Project&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Project&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;not_eq&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PipelineTesting&#39;</span><span class="p">,</span>
                                        <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All “Plasma” samples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Sample</span><span class="o">.</span><span class="n">sample_type</span><span class="o">==</span><span class="s1">&#39;Plasma&#39;</span><span class="p">)</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;sample_type&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Plasma&#39;</span><span class="p">,</span>
                                        <span class="p">}]</span>
                          <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All “HPOS” samples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SampleAssay</span><span class="p">,</span><span class="n">Assay</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Assay</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;HPOS&#39;</span><span class="p">)</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;SampleAssay&#39;</span><span class="p">,</span><span class="s1">&#39;Assay&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Assay&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;HPOS&#39;</span><span class="p">,</span>
                                        <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All samples with subjects between ages 30 and 40</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MetadataValue</span><span class="p">,</span><span class="n">MetadataField</span><span class="p">,</span><span class="n">HarmonisedMetadataField</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">HarmonisedMetadataField</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MetadataValue</span><span class="o">.</span><span class="n">harmonised_numeric_value</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;MetadataValue&#39;</span><span class="p">,</span><span class="s1">&#39;MetadataField&#39;</span><span class="p">,</span><span class="s1">&#39;HarmonisedMetadataField&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;HarmonisedMetadataField&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span>
                                        <span class="p">}]</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;MetadataValue&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;harmonised_numeric_value&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">]</span>
                                        <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All samples with ‘Glucose’ annotations, with intensity &gt; 0.3</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SampleAssay</span><span class="p">,</span><span class="n">AnnotatedFeature</span><span class="p">,</span><span class="n">Annotation</span><span class="p">,</span><span class="n">AnnotationCompound</span><span class="p">,</span><span class="n">Compound</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Compound</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;Glucose&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">AnnotatedFeature</span><span class="o">.</span><span class="n">intensity</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;SampleAssay&#39;</span><span class="p">,</span><span class="s1">&#39;AnnotatedFeature&#39;</span><span class="p">,</span><span class="s1">&#39;Annotation&#39;</span><span class="p">,</span><span class="s1">&#39;AnnotationCompound&#39;</span><span class="p">,</span><span class="s1">&#39;Compound&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span> <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                          <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Compound&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                          <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Glucose&#39;</span><span class="p">,</span>
                                      <span class="p">}]</span>
                            <span class="p">},</span>
                            <span class="p">{</span> <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;AnnotatedFeature&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;intensity&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;gt&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.3</span>
                                          <span class="p">}]</span>
                            <span class="p">},</span>
                          <span class="p">]}</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All samples with Pubchem CID 16217534 annotations, with intensity &gt; 0.3</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SampleAssay</span><span class="p">,</span><span class="n">AnnotatedFeature</span><span class="p">,</span><span class="n">Annotation</span><span class="p">,</span><span class="n">AnnotationCompound</span><span class="p">,</span><span class="n">Compound</span><span class="p">,</span><span class="n">CompoundExternalDB</span><span class="p">,</span><span class="n">ExternalDB</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ExternalDB</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;PubChem CID&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CompoundExternalDB</span><span class="o">.</span><span class="n">database_ref</span><span class="o">==</span><span class="s1">&#39;16217534&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">AnnotatedFeature</span><span class="o">.</span><span class="n">intensity</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span>


<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;SampleAssay&#39;</span><span class="p">,</span><span class="s1">&#39;AnnotatedFeature&#39;</span><span class="p">,</span><span class="s1">&#39;Annotation&#39;</span><span class="p">,</span><span class="s1">&#39;AnnotationCompound&#39;</span><span class="p">,</span><span class="s1">&#39;Compound&#39;</span>
                        <span class="s1">&#39;CompoundExternalDB&#39;</span><span class="p">,</span><span class="s1">&#39;ExternalDB&#39;</span><span class="p">],</span>
              <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span> <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                          <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ExternalDB&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                          <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PubChem CID&#39;</span><span class="p">,</span>
                                      <span class="p">}]</span>
                            <span class="p">},</span>
                            <span class="p">{</span> <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;CompoundExternalDB&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;database_ref&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;16217534&#39;</span><span class="p">,</span>
                                          <span class="p">}]</span>

                            <span class="p">},</span>
                            <span class="p">{</span> <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;AnnotatedFeature&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;intensity&#39;</span><span class="p">,</span>
                                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;gt&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
                                          <span class="p">}]</span>

                            <span class="p">},</span>
                          <span class="p">]}</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All samples from PipelineTesting project OR nPYc-toolbox-tutorials</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span><span class="n">Project</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Project</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;PipelineTesting&#39;</span> <span class="o">|</span> <span class="n">Project</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;nPYc-toolbox-tutorials&#39;</span><span class="p">)</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span><span class="s1">&#39;Project&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Project&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PipelineTesting&#39;</span><span class="p">,</span>
                                              <span class="p">},</span>
                                              <span class="p">{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Project&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;nPYc-toolbox-tutorials&#39;</span><span class="p">,</span>
                                              <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All from PipelineTesting project OR nPYc-toolbox-tutorials and with annotations with Pubchem CID ref IN (‘16217534’, ‘3082637’)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span><span class="n">Project</span><span class="p">,</span><span class="n">SampleAssay</span><span class="p">,</span><span class="n">AnnotatedFeature</span><span class="p">,</span>\
    <span class="n">Annotation</span><span class="p">,</span><span class="n">AnnotationCompound</span><span class="p">,</span><span class="n">Compound</span><span class="p">,</span><span class="n">CompoundExternalDB</span><span class="p">,</span><span class="n">ExternalDB</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Project</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;PipelineTesting&#39;</span> <span class="o">|</span> <span class="n">Project</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;nPYc-toolbox-tutorials&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ExternalDB</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;PubChem CID&#39;</span> <span class="o">&amp;</span> <span class="n">CompoundExternalDB</span><span class="o">.</span><span class="n">database_ref</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s1">&#39;16217534&#39;</span><span class="p">,</span><span class="s1">&#39;3082637&#39;</span><span class="p">])</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span><span class="s1">&#39;SampleAssay&#39;</span><span class="p">,</span><span class="s1">&#39;Annotation&#39;</span><span class="p">,</span><span class="s1">&#39;AnnotatedFeature&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;AnnotationCompound&#39;</span><span class="p">,</span><span class="s1">&#39;Compound&#39;</span><span class="p">,</span><span class="s1">&#39;CompoundExternalDB&#39;</span><span class="p">,</span><span class="s1">&#39;ExternalDB&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Project&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PipelineTesting&#39;</span><span class="p">,</span>
                                              <span class="p">},</span>
                                              <span class="p">{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Project&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;nPYc-toolbox-tutorials&#39;</span>
                                              <span class="p">}]</span>
                            <span class="p">},{</span>
                              <span class="s1">&#39;filter_operator&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ExternalDB&#39;</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PubChem CID&#39;</span><span class="p">,</span>
                                              <span class="p">},</span>
                                              <span class="p">{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;CompoundExternalDB&#39;</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;database_ref&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;16217534&#39;</span><span class="p">,</span><span class="s1">&#39;3082637&#39;</span><span class="p">]</span>
                                              <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>All annotations that a not PubChem CID (‘16217534’, ‘3082637’)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SampleAssay</span><span class="p">,</span> <span class="n">Annotation</span><span class="p">,</span><span class="n">AnnotatedFeature</span><span class="p">,</span>\
    <span class="n">AnnotationCompound</span><span class="p">,</span><span class="n">Compound</span><span class="p">,</span><span class="n">CompoundExternalDB</span><span class="p">,</span><span class="n">ExternalDB</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ExternalDB</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;PubChem CID&#39;</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">CompoundExternalDB</span><span class="o">.</span><span class="n">database_ref</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s1">&#39;16217534&#39;</span><span class="p">,</span><span class="s1">&#39;3082637&#39;</span><span class="p">])</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;joins&#39;</span><span class="p">:[</span><span class="s1">&#39;SampleAssay&#39;</span><span class="p">,</span><span class="s1">&#39;Annotation&#39;</span><span class="p">,</span><span class="s1">&#39;AnnotatedFeature&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;AnnotationCompound&#39;</span><span class="p">,</span><span class="s1">&#39;Compound&#39;</span><span class="p">,</span><span class="s1">&#39;CompoundExternalDB&#39;</span><span class="p">,</span><span class="s1">&#39;ExternalDB&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="p">[{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ExternalDB&#39;</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PubChem CID&#39;</span><span class="p">,</span>
                                              <span class="p">},</span>
                                              <span class="p">{</span>
                                                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;CompoundExternalDB&#39;</span>
                                                <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;database_ref&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s1">&#39;not_in&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;16217534&#39;</span><span class="p">,</span><span class="s1">&#39;3082637&#39;</span><span class="p">]</span>
                                              <span class="p">}]</span>
                            <span class="p">}]</span>
              <span class="p">}</span>
</pre></div>
</div>
<span class="target" id="module-phenomedb.query_factory"></span><dl class="py class">
<dt class="sig sig-object py" id="phenomedb.query_factory.MetadataFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phenomedb.query_factory.</span></span><span class="sig-name descname"><span class="pre">MetadataFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">harmonised_metadata_field_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.MetadataFilter" title="Permalink to this definition"></a></dt>
<dd><p>MetadataFilter class. Creates a sub_filter with 2 matches.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>harmonised_metadata_field_name</strong> (<em>str</em>) – The name of the harmonised_metadata_field.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phenomedb.query_factory.ProjectRoleFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phenomedb.query_factory.</span></span><span class="sig-name descname"><span class="pre">ProjectRoleFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">role_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.ProjectRoleFilter" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phenomedb.query_factory.</span></span><span class="sig-name descname"><span class="pre">QueryFactory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">saved_query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saved_query_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_session</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">project_short_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_description</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">role_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SampleAssay'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory" title="Permalink to this definition"></a></dt>
<dd><p>Class for building, executing, and saving SQLAlchemy queries that define ‘SavedQueries’, and generating and caching result set dataframes, such as the nPYc format.</p>
<p>A QueryFactory is simply a collection of filters that match on table properties.</p>
<p>Generates an SQLAlchemy query object that allows for further filters to be added as required, or .all() or
.count() methods to be used.</p>
<p>A join route calculator helps build the query by knowing the route between filter tables and the output model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>saved_query</strong> (<a class="reference internal" href="models.html#phenomedb.models.SavedQuery" title="phenomedb.models.SavedQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.models.SavedQuery</span></code></a>, optional) – A <a class="reference internal" href="models.html#phenomedb.models.SavedQuery" title="phenomedb.models.SavedQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.models.SavedQuery</span></code></a> object, defaults to None</p></li>
<li><p><strong>saved_query_id</strong> (<em>int</em><em>, </em><em>optional</em>) – A <a class="reference internal" href="models.html#phenomedb.models.SavedQuery" title="phenomedb.models.SavedQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.models.SavedQuery</span></code></a> ID, defaults to None</p></li>
<li><p><strong>filters</strong> (<em>dict</em><em>, </em><em>optional</em>) – A dictionary of specifying the query filters, defaults to None</p></li>
<li><p><strong>query_dict</strong> (<em>dict</em><em>, </em><em>optional</em>) – A dictionary specifying an entire query definition, defaults to None</p></li>
<li><p><strong>db_env</strong> (<em>str</em><em>, </em><em>optional</em>) – The db to use ‘PROD’ or ‘TEST’, defaults to None</p></li>
<li><p><strong>db_session</strong> (<em>object</em><em>, </em><em>optional</em>) – The db session to use, defaults to None</p></li>
<li><p><strong>project_short_label</strong> (<em>str</em><em>, </em><em>optional</em>) – A short label to add to a query for easier visualisation, defaults to None</p></li>
<li><p><strong>query_name</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the query, defaults to None</p></li>
<li><p><strong>query_description</strong> (<em>_type_</em><em>, </em><em>optional</em>) – The description of the query, defaults to None</p></li>
<li><p><strong>username</strong> (<em>str</em><em>, </em><em>optional</em>) – The username of the user who created the query, defaults to None</p></li>
<li><p><strong>output_model</strong> (<em>str</em><em>, </em><em>optional</em>) – The output model to use, defaults to ‘SampleAssay’, but typically might be ‘AnnotatedFeature’</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – _description_</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.add_filter">
<span class="sig-name descname"><span class="pre">add_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter_operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AND'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">match_dicts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.add_filter" title="Permalink to this definition"></a></dt>
<dd><p>Add a filter to the query_dict. Either generate a new one with this method or pass in a filter_dict or QueryFilter()</p>
<blockquote>
<div><dl>
<dt>Usage:</dt><dd><p>query_factory = CohortQuery()
filter = QueryFilter(filter_operator=’AND’)
filter.add_match(QueryMatch(model=’Project’,property=’name’,operator=’eq’,value=’PipelineTesting’))
cohort_query.add_filter(query_filter=filter)
cohort_query.calculate_joins()</p>
</dd>
<dt>filter = {</dt><dd><blockquote>
<div><p>‘filter_operator’: ‘AND’,
‘matches’: [{</p>
<blockquote>
<div><p>‘model’: ‘Project’,
‘property’: ‘name’,
“operator”: ‘eq’,
‘value’: ‘PipelineTesting’,</p>
</div></blockquote>
<p>}]</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter_operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The top-level filter operator, “AND” or “OR”, defaults to “AND”.</p></li>
<li><p><strong>match_dicts</strong> (<em>list</em><em>, </em><em>optional</em>) – List of match dictionaries, defaults to [].</p></li>
<li><p><strong>filter_dict</strong> (<em>dict</em><em>, </em><em>optional</em>) – The filter dictionary to use, defaults to None.</p></li>
<li><p><strong>query_filter</strong> (<a class="reference internal" href="#phenomedb.query_factory.QueryFilter" title="phenomedb.query_factory.QueryFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.query_factory.QueryFilter</span></code></a>, optional) – The query filter object to use, defaults to None.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The model to match on, defaults to None.</p></li>
<li><p><strong>property</strong> (<em>str</em><em>, </em><em>optional</em>) – The property to match on, defaults to None.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_comparison_operation">
<span class="sig-name descname"><span class="pre">build_comparison_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_comparison_operation" title="Permalink to this definition"></a></dt>
<dd><p>Builds a comparison operation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>match</strong> (<em>dict</em>) – The match dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_filter_string">
<span class="sig-name descname"><span class="pre">build_filter_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_filter_string" title="Permalink to this definition"></a></dt>
<dd><p>Builds the filter string based on a query_dict filter</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filter</strong> (<em>dict</em>) – The filter to build.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_function_operation">
<span class="sig-name descname"><span class="pre">build_function_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_function_operation" title="Permalink to this definition"></a></dt>
<dd><p>Builds a function operation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>match</strong> (<em>dict</em>) – The match dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_intensity_data_sample_metadata_and_feature_metadata">
<span class="sig-name descname"><span class="pre">build_intensity_data_sample_metadata_and_feature_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_features_with_na_feature_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns_to_exclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns_to_include</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">harmonise_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AnnotatedFeature'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compound_fields_to_include</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compound_class_types_to_include</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mmol/L'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_intensity_data_sample_metadata_and_feature_metadata" title="Permalink to this definition"></a></dt>
<dd><p>Takes a combined dataframe and build the 3-file format</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_dir</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>exclude_features_with_na_feature_values</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to False</p></li>
<li><p><strong>columns_to_exclude</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>columns_to_include</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>harmonise_annotations</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to False</p></li>
<li><p><strong>output_model</strong> (<em>str</em><em>, </em><em>optional</em>) – _description_, defaults to ‘AnnotatedFeature’</p></li>
<li><p><strong>class_type</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>class_level</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>aggregate_function</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>correction_type</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>save_cache</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to True</p></li>
<li><p><strong>compound_fields_to_include</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>compound_class_types_to_include</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>convert_units</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to True</p></li>
<li><p><strong>master_unit</strong> (<em>str</em><em>, </em><em>optional</em>) – _description_, defaults to ‘mmol/L’</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>Exception</strong> – _description_</p></li>
<li><p><strong>Exception</strong> – _description_</p></li>
<li><p><strong>Exception</strong> – _description_</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_logical_operator">
<span class="sig-name descname"><span class="pre">build_logical_operator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">operator</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_logical_operator" title="Permalink to this definition"></a></dt>
<dd><p>Builds a logical operator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>operator</strong> (<em>str</em>) – The operator to use (AND or OR).</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – If the filter type is unknown.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_match_string">
<span class="sig-name descname"><span class="pre">build_match_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_match_string" title="Permalink to this definition"></a></dt>
<dd><p>Build the match string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>match</strong> (<em>dict</em>) – The match dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_match_value">
<span class="sig-name descname"><span class="pre">build_match_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_match_value" title="Permalink to this definition"></a></dt>
<dd><p>Builds the match value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>match</strong> (<em>dict</em>) – The match dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_model_property_name">
<span class="sig-name descname"><span class="pre">build_model_property_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_model_property_name" title="Permalink to this definition"></a></dt>
<dd><p>Builds the model property name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>match</strong> (<em>dict</em>) – The match dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_query_string">
<span class="sig-name descname"><span class="pre">build_query_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SampleAssay'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">harmonise_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_query_string" title="Permalink to this definition"></a></dt>
<dd><p>Translates the query_dict into an SQLAlchemy query object string</p>
<p>ie:</p>
<p>query = db_session.query(SampleAssay).join(Sample,Subject,Project).filter(Project.name==’PipelineTesting’)</p>
<dl>
<dt>query_dict = {  ‘model’: ‘SampleAssay’,</dt><dd><blockquote>
<div><p>‘joins’:[‘Subject’,’Project’],
‘filters’: [{</p>
<blockquote>
<div><p>‘filter_operator’: ‘AND’
‘sub_filters’: [{</p>
<blockquote>
<div><p>‘sub_filter_operator’: ‘AND’,
‘matches’: [{</p>
<blockquote>
<div><blockquote>
<div><p>‘model’: ‘Project’,
‘property’: ‘name’,
“operator”: ‘eq’,</p>
</div></blockquote>
<p>‘value’: ‘PipelineTesting’,</p>
</div></blockquote>
<p>}]</p>
</div></blockquote>
<p>}]</p>
</div></blockquote>
<p>}]</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.build_sub_filter_string">
<span class="sig-name descname"><span class="pre">build_sub_filter_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_filter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.build_sub_filter_string" title="Permalink to this definition"></a></dt>
<dd><p>Builds the sub filter string based on the query_dict subfilter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sub_filter</strong> (<em>dict</em>) – The subfilter to build.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.calculate_joins">
<span class="sig-name descname"><span class="pre">calculate_joins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SampleAssay'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.calculate_joins" title="Permalink to this definition"></a></dt>
<dd><p>Calculates the joins necessary to execute the query</p>
<blockquote>
<div><p>Uses prior information of the join routes from the main model to the match model</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>output_model</strong> (<em>str</em><em>, </em><em>optional</em>) – The output model to calculate for, defaults to ‘SampleAssay’, but could be ‘AnnotatedFeature’</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.calculate_summary_statistics">
<span class="sig-name descname"><span class="pre">calculate_summary_statistics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.calculate_summary_statistics" title="Permalink to this definition"></a></dt>
<dd><p>Calculate the summary statistics of the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>summary: dictionary of summary statistics.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.delete_cache">
<span class="sig-name descname"><span class="pre">delete_cache</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.delete_cache" title="Permalink to this definition"></a></dt>
<dd><p>Delete any saved cache entries for this query</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.execute_and_build_dataframe">
<span class="sig-name descname"><span class="pre">execute_and_build_dataframe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">annotations_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">csv_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort_by</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotation_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'latest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SampleAssay'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort_by_ascending</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(True,</span> <span class="pre">True)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mmol/L'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_lloq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inf_uloq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">harmonise_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.execute_and_build_dataframe" title="Permalink to this definition"></a></dt>
<dd><blockquote>
<div><p>Builds dataframe with following structure.</p>
<p>project_name, sample_name, unique_name, metadata::age, h_metadata::age, cpd::HPOS-PPR::Glucose::mmol/L, m::HPOS::rt:37:mz:12.13::mmol/L
npc-devset, sample_1, npc-devset-sample_1, 20,          20,             0.1</p>
<p>metadata::age -&gt; MetadataField called “age”
h_metadata::Age -&gt; HarmonisedMetadataField called “Age”
cpd::HPOS-PPR:Glucose -&gt; HPOS-PPR AnnotationCompound called “Glucose”</p>
<p>Converts units by default to mmol/L</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.execute_query">
<span class="sig-name descname"><span class="pre">execute_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.execute_query" title="Permalink to this definition"></a></dt>
<dd><p>Execute the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<em>str</em><em>, </em><em>optional</em>) – What kind of query, ‘all’, ‘first’, or ‘count’, defaults to “all”.</p></li>
<li><p><strong>limit</strong> (<em>int</em><em>, </em><em>optional</em>) – The query limit, defaults to None.</p></li>
<li><p><strong>offset</strong> (<em>int</em><em>, </em><em>optional</em>) – The query offset, defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>Exception</strong> – type not recognised.</p></li>
<li><p><strong>Exception</strong> – no query object to execute.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.generate_and_execute_query">
<span class="sig-name descname"><span class="pre">generate_and_execute_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SampleAssay'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.generate_and_execute_query" title="Permalink to this definition"></a></dt>
<dd><p>Generate and execute the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<em>str</em><em>, </em><em>optional</em>) – What kind of query, ‘all’, ‘first’, or ‘count’, defaults to “all”.</p></li>
<li><p><strong>limit</strong> (<em>int</em><em>, </em><em>optional</em>) – The query limit, defaults to None.</p></li>
<li><p><strong>offset</strong> (<em>int</em><em>, </em><em>optional</em>) – The query offset, defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the query results.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, <code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.models.*</span></code>, or list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.generate_query">
<span class="sig-name descname"><span class="pre">generate_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SampleAssay'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">harmonise_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.generate_query" title="Permalink to this definition"></a></dt>
<dd><p>Generate the query. Builds the query code string and evaluates it.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>Exception</strong> – If the query is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.get_code_string">
<span class="sig-name descname"><span class="pre">get_code_string</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.get_code_string" title="Permalink to this definition"></a></dt>
<dd><p>Gets the SQLAlchemy code string</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The SQLAlchemy code string</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.get_dataframe_key">
<span class="sig-name descname"><span class="pre">get_dataframe_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotation_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">harmonise_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_bin_definition</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mmol/L'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.get_dataframe_key" title="Permalink to this definition"></a></dt>
<dd><p>_summary_</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<em>str</em>) – The file type, for example ‘combined’,’intensity_data’,’sample_metadata’, ‘feature_metadata’,’feature_id_matrix’,’feature_id_combined_dataframe’, ‘metaboanalyst_data’,’metaboanalyst_metadata’</p></li>
<li><p><strong>model</strong> (<em>str</em>) – The output model, for example ‘AnnotatedFeature’</p></li>
<li><p><strong>class_type</strong> (<em>str</em><em>, </em><em>optional</em>) – The class type (for CompoundClass aggregations), defaults to None</p></li>
<li><p><strong>class_level</strong> (<em>str</em><em>, </em><em>optional</em>) – The class level to aggregate by (for CompoundClass aggregations), defaults to None</p></li>
<li><p><strong>correction_type</strong> (<em>str</em><em>, </em><em>optional</em>) – The correction type to use. Typically you want to specificy None for NMR data and ‘SR’ for LC-MS data, defaults to None</p></li>
<li><p><strong>aggregate_function</strong> (<em>str</em><em>, </em><em>optional</em>) – The aggregration function to use, mean, sum etc (for CompoundClass aggregations), defaults to None</p></li>
<li><p><strong>annotation_version</strong> (<em>str</em><em>, </em><em>optional</em>) – The verison fo the annotation to use, will use latest if not specified, defaults to None</p></li>
<li><p><strong>db_env</strong> (<em>str</em><em>, </em><em>optional</em>) – The DB env, ‘PROD’ or ‘TEST’, defaults to None</p></li>
<li><p><strong>harmonise_annotations</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to harmonise the annotations or not, defaults to False</p></li>
<li><p><strong>convert_units</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to convert units, defaults to True</p></li>
<li><p><strong>master_unit</strong> (<em>str</em><em>, </em><em>optional</em>) – The master unit to convert to (for absolute quantified data), defaults to ‘mmol/L’</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>Exception</strong> – _description_</p></li>
<li><p><strong>Exception</strong> – _description_</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>_description_</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>_type_</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.get_query_rows">
<span class="sig-name descname"><span class="pre">get_query_rows</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.get_query_rows" title="Permalink to this definition"></a></dt>
<dd><p>Get the query result rows.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The query results.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int, <code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.models.*</span></code>, or list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.get_unique_match_models">
<span class="sig-name descname"><span class="pre">get_unique_match_models</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.get_unique_match_models" title="Permalink to this definition"></a></dt>
<dd><blockquote>
<div><p>Get all unique models and map the joins between these models and the main model.
Add the</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.load_dataframe">
<span class="sig-name descname"><span class="pre">load_dataframe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'combined'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">combined_csv_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mmol/L'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reload_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotation_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AnnotatedFeature'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">harmonise_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_lloq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inf_uloq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.load_dataframe" title="Permalink to this definition"></a></dt>
<dd><p>The main access point for queries. Checks the cache first, if it doesn’t exist, executes the query, builds the dataframes and stores them in the cache.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<em>str</em><em>, </em><em>optional</em>) – _description_, defaults to ‘combined’</p></li>
<li><p><strong>combined_csv_path</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>convert_units</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to True</p></li>
<li><p><strong>master_unit</strong> (<em>str</em><em>, </em><em>optional</em>) – _description_, defaults to ‘mmol/L’</p></li>
<li><p><strong>reload_cache</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to False</p></li>
<li><p><strong>correction_type</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>annotation_version</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>output_model</strong> (<em>str</em><em>, </em><em>optional</em>) – _description_, defaults to ‘AnnotatedFeature’</p></li>
<li><p><strong>output_dir</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>harmonise_annotations</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to False</p></li>
<li><p><strong>class_level</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>class_type</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>zero_lloq</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to True</p></li>
<li><p><strong>inf_uloq</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to True</p></li>
<li><p><strong>aggregate_function</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>save_cache</strong> (<em>bool</em><em>, </em><em>optional</em>) – _description_, defaults to True</p></li>
<li><p><strong>sample_label</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
<li><p><strong>feature_label</strong> (<em>_type_</em><em>, </em><em>optional</em>) – _description_, defaults to None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>_description_</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>_type_</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.save_query">
<span class="sig-name descname"><span class="pre">save_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'custom'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.save_query" title="Permalink to this definition"></a></dt>
<dd><p>Save the query definition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>type</strong> (<em>str</em><em>, </em><em>optional</em>) – The query definition type, defaults to ‘custom’.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The SavedQuery.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="models.html#phenomedb.models.SavedQuery" title="phenomedb.models.SavedQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.models.SavedQuery</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFactory.set_db_session">
<span class="sig-name descname"><span class="pre">set_db_session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_session</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFactory.set_db_session" title="Permalink to this definition"></a></dt>
<dd><p>Set the db session</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_session</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.Session</span></code>) – The db_session to use, default None.</p></li>
<li><p><strong>db_env</strong> (<em>str</em>) – The db to use, “PROD”, “BETA”, or “TEST, default None (“PROD”)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phenomedb.query_factory.</span></span><span class="sig-name descname"><span class="pre">QueryFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter_operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AND'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFilter" title="Permalink to this definition"></a></dt>
<dd><p>QueryFilter class. Class for storing filter objects to simplify generating queries.</p>
<blockquote>
<div><dl>
<dt>Example usage:</dt><dd><p>AND filter:
filter = QueryFilter(“AND”)
sub_filter = QuerySubFilter(“AND”)
subfilter.add_match(model=”Project”,property=”name”,operator=”eq”,value=”PipelineTesting”)
cohort_query = CohortQuery()
cohort_query.add_filter(filter)</p>
<p>OR filter:
filter = QueryFilter(‘OR’)
sub_filter = QuerySubFilter(“AND”)
filter.add_match(model=”Project”,property=”name”,operator=”eq”,value=”PipelineTesting”)
filter.add_match(model=”Project”,property=”name”,operator=”eq”,value=”nPYc-toolbox-tutorials”)
cohort_query = CohortQuery()
cohort_query.add_filter(filter)</p>
<p>simple AND:
filter = QueryFilter(“AND”,model=”Project”,property=”name”,operator=”eq”,value=”PipelineTesting”)</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter_operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The top-level filter operator, “AND” or “OR”, defaults to “AND”.</p></li>
<li><p><strong>filter_dict</strong> (<em>dict</em><em>, </em><em>optional</em>) – The filter dictionary to use, defaults to None.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The model to match on, defaults to None.</p></li>
<li><p><strong>property</strong> (<em>str</em><em>, </em><em>optional</em>) – The property to match on, defaults to None.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFilter.add_match">
<span class="sig-name descname"><span class="pre">add_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query_sub_filter_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">match_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFilter.add_match" title="Permalink to this definition"></a></dt>
<dd><p>Add a match to the Filter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query_sub_filter_match</strong> (<em>dict</em><em>, </em><em>optional</em>) – The QuerySubFilter + QueryMatch to add, defaults to None.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The model to match on, defaults to None.</p></li>
<li><p><strong>property</strong> (<em>str</em><em>, </em><em>optional</em>) – The property to match on, defaults to None.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
<li><p><strong>match_dict</strong> (<em>dict</em><em>, </em><em>optional</em>) – The match dictionary to add, defaults to None</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFilter.add_sub_filter">
<span class="sig-name descname"><span class="pre">add_sub_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_filter_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_filter_operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AND'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFilter.add_sub_filter" title="Permalink to this definition"></a></dt>
<dd><p>Add a subfilter to the filter. Either QuerySubFilter, or sub_filter_dict, or match properties.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sub_filter</strong> (<a class="reference internal" href="#phenomedb.query_factory.QuerySubFilter" title="phenomedb.query_factory.QuerySubFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">phenomedb.query_factory.QuerySubFilter</span></code></a>, optional) – The QuerySubFilter to add, defaults to None.</p></li>
<li><p><strong>sub_filter_dict</strong> (<em>dict</em><em>, </em><em>optional</em>) – The sub_filter dictionary to add, defaults to None.</p></li>
<li><p><strong>sub_filter_operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The sub_filter operator, ‘AND’ or ‘OR’, defaults to ‘AND’.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The model to match on, defaults to None.</p></li>
<li><p><strong>property</strong> (<em>str</em><em>, </em><em>optional</em>) – The property to match on, defaults to None.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryFilter.get_filter_dict">
<span class="sig-name descname"><span class="pre">get_filter_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryFilter.get_filter_dict" title="Permalink to this definition"></a></dt>
<dd><p>Get the filter dictionary corresponding to this filter.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The filter dictionary.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryMatch">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phenomedb.query_factory.</span></span><span class="sig-name descname"><span class="pre">QueryMatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">match_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryMatch" title="Permalink to this definition"></a></dt>
<dd><p>QueryMatch class. Class for building Match object to simplify generating queries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The model to match on, defaults to None.</p></li>
<li><p><strong>property</strong> (<em>str</em><em>, </em><em>optional</em>) – The property to match on, defaults to None.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
<li><p><strong>match_dict</strong> (<em>dict</em><em>, </em><em>optional</em>) – The match dictionary to add, defaults to None</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – If not all match properties are set.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QueryMatch.get_match_dict">
<span class="sig-name descname"><span class="pre">get_match_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QueryMatch.get_match_dict" title="Permalink to this definition"></a></dt>
<dd><p>Get the match_dict from the QueryMatch.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the match_dictionary.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phenomedb.query_factory.QuerySubFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phenomedb.query_factory.</span></span><span class="sig-name descname"><span class="pre">QuerySubFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_filter_operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AND'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_filter_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QuerySubFilter" title="Permalink to this definition"></a></dt>
<dd><blockquote>
<div><p>QuerySubFilter class. Class for storing subfilter objects to simplify generating nested and/or queries.</p>
<dl class="simple">
<dt>Example usage:</dt><dd><dl class="simple">
<dt>AND filter:</dt><dd><p>filter = QueryFilter(filter_operator=”AND”)
sub_filter = QuerySubFilter(sub_filter_operator=”AND”)
sub_filter.add_match(model=”Project”,property=”name”,operator=”eq”,value=”PipelineTesting”)
filter.add_sub_filter(add_sub_filter)
cohort_factory = SampleFactory()
cohort_factory.add_filter(filter)</p>
</dd>
<dt>OR filter:</dt><dd><p>filter = QueryFilter(filter_operator=’OR’)
sub_filter = QuerySubFilter(sub_filter_operator=”AND”)
sub_filter.add_match(model=”Project”,property=”name”,operator=”eq”,value=”PipelineTesting”)
sub_filter.add_match(model=”Project”,property=”name”,operator=”eq”,value=”nPYc-toolbox-tutorials”)
filter.add_sub_filter(sub_filter)
cohort_factory = SampleFactory()
cohort_factory.add_filter(filter)</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sub_filter_operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The sub_filter operator, ‘AND’ or ‘OR’, defaults to ‘AND’.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The model to match on, defaults to None.</p></li>
<li><p><strong>property</strong> (<em>str</em><em>, </em><em>optional</em>) – The property to match on, defaults to None.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QuerySubFilter.add_match">
<span class="sig-name descname"><span class="pre">add_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query_sub_filter_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">match_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QuerySubFilter.add_match" title="Permalink to this definition"></a></dt>
<dd><p>Add a match to the QuerySubFilter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query_sub_filter_match</strong> (<em>dict</em><em>, </em><em>optional</em>) – The QuerySubFilter + QueryMatch to add, defaults to None.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The model to match on, defaults to None.</p></li>
<li><p><strong>property</strong> (<em>str</em><em>, </em><em>optional</em>) – The property to match on, defaults to None.</p></li>
<li><p><strong>operator</strong> (<em>str</em><em>, </em><em>optional</em>) – The operator to use, defaults to None.</p></li>
<li><p><strong>value</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, or </em><em>list</em><em>, </em><em>optional</em>) – The value to match on, defaults to None.</p></li>
<li><p><strong>match_dict</strong> (<em>dict</em><em>, </em><em>optional</em>) – The match dictionary to add, defaults to None</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenomedb.query_factory.QuerySubFilter.get_sub_filter_dict">
<span class="sig-name descname"><span class="pre">get_sub_filter_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#phenomedb.query_factory.QuerySubFilter.get_sub_filter_dict" title="Permalink to this definition"></a></dt>
<dd><p>Get the sub_filter_dict from the QuerySubFilter.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>sub_filter_dictionary</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pipelines.html" class="btn btn-neutral float-left" title="phenomedb.pipelines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="task.html" class="btn btn-neutral float-right" title="phenomedb.task" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Imperial College London.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>