{% extends 'base.html' %}
{% block plugin_content %}
<div class="container-fluid">
	<div class="row">
	    <h3 class="page-heading">Sampling Event ID:{{ data.sample.id}} - {{ data.sample.subject.project.name }} - {{ data.sample.subject.name }} - {{ data.sample.name }} - {{ data.sample.sample_matrix }} - {{ data.sample.sample_type.value }}</h3>
	</div>
  
	<div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
				<div class="panel-heading"><a class="accordion-toggle" href="#se-summary" data-toggle="collapse">Summary</a></div>
				<div class="panel-body collapse in" id="se-summary">
				    <div class="row">
				        <div class="table-label col-xs-3">Project</div>
				        <div class="table-value col-xs-9">{{data.sample.subject.project.name }}</div>
				    </div>
				     <div class="row">
				        <div class="table-label col-xs-3">Subject</div>
				        <div class="table-value col-xs-9"> {{ data.sample.subject.name }}</div>
				       </div>
				     <div class="row">
				        <div class="table-label col-xs-3">Sample ID</div>
				        <div class="table-value col-xs-9"> {{ data.sample.name }}</div>
				       </div>
				     <div class="row">
				        <div class="table-label col-xs-3">Sampling Date</div>
				        <div class="table-value col-xs-9"> {{ data.sample.sampling_date }}</div>
				       </div>
				     <div class="row">
				        <div class="table-label col-xs-3">Sample Matrix</div>
				        <div class="table-value col-xs-9"> {{ data.sample.sample_matrix }}</div>
				       </div>
				     <div class="row">
				        <div class="table-label col-xs-3">Sample Type</div>
				        <div class="table-value col-xs-9"> {{ data.sample.sample_type.value }}</div>
				       </div>
				     <div class="row">
				        <div class="table-label col-xs-3">Assay Role</div>
				        <div class="table-value col-xs-9"> {{ data.sample.assay_role.value }}</div>
				      </div>                  
			   </div>
			</div>
		</div>
		<div class="col-md-6">
		    <div class="panel panel-default">
		        <div class="panel-heading"><a class="accordion-toggle" href="#se-metadata" data-toggle="collapse">Metadata</a></div>
		        <div class="panel-body collapse in" id="se-metadata">
		            <table class="table table-condensed">
		            <thead>
		            	<th>Field</th>
		            	<th>Raw value</th>
		            	<th>Harmonised value</th>
		            </thead>
		            <tbody>
		            {% for item in data.metadata %}
		            	<tr>
		            		<td>{{item.name}}</td>
		            		<td>{{item.raw_value}}</td>
		            		<td>{{item.harmonised_text_value}} {{item.harmonised_numeric_value}} {{item.harmonised_datetime_value}}</td>
		            	</tr>
		             {% endfor %}
		            </tbody>
		            </table>
		        </div>
		    </div>
		</div>
	</div>
	
      {% for sample_assay in data.sample.sample_assays %}
      <div class=" row">
      	<div class="panel panel-default">
          	<div class="panel-heading">
          		<a class="accordion-toggle" href="#sea-{{ sample_assay.id }}" data-toggle="collapse">
          		{{ sample_assay.assay.name }}
          		</a>
          	</div>
          	<div class="panel-body collapse" id="sea-{{ sample_assay.id }}">
              	<div class="row">
                  	<div class="col-md-6">

						<div class="row">
				        	<div class="table-label col-xs-4">Sampling Event Assay ID</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.id }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Acquired Time</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.acquired_time }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Raw Spectra path</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.raw_spectra_path }}</div>
				        </div>
						<div class="row">
				        	<div class="table-label col-xs-4">Processed Spectra Path</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.processed_spectra_path }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Excluded</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.excluded }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Excluded Reason</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.excluded_reason }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Acquisition Instrument</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.acquisition_instrument }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Sample File Name</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.sample_file_name }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Sample Base Name</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.sample_base_name }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Expno</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.expno }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Position</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.position }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Run Order</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.run_order }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Batch</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.batch }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Acquisition Run</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.acquisition_run }}</div>
				        </div>
                        <div class="row">
				        	<div class="table-label col-xs-4">Dilution</div>
				        	<div class="table-value col-xs-8">{{ sample_assay.dilution }}</div>
                       </div>
					</div>
                  	
                   <div class="col-md-6">
                       {% if sample_assay.assay.platform.value == 'MassSpectrometry'
                       		and sample_assay.assay.targeted == 'N' %}
                       <div class="row">
                           <a href="{{ url_for('ViewData.xcms_features', id=sample_assay.id) }}" class="button">
                           		View XCMS features
                           	</a>
                       </div>
                       {% endif %}
                       <div class="row">
                           <div class='col-md-12'>
                               <h4>Annotation methods</h4>

								{% if sample_assay.measurements|length > 0 %}
								<div class="table-label col-xs-3">{{sample_assay.measurements[0].annotation.compound_annotation.annotation_method.name }} </div>
								
								<div class="table-value col-xs-9">{{sample_assay.measurements|length }} measurements</div>
								
								{%endif%}
								                             
                           </div>
                       </div>
                   </div>
              	</div>
          	</div>
      	</div>
  	</div>
	{% endfor %}
	
	<div class="row">
	    <div class="panel panel-default">
	        <div class="panel-heading"><a class="accordion-toggle" href="#se-all-measurements" data-toggle="collapse">Measurements</a></div>
	        <div class="panel-body collapse" id="se-all-measurements">
	            <div class="dataTable_wrapper">
	                <table id="table_data" class="table table-striped table-bordered table-hover wrap"></table>
	            </div>
	        </div>
	    </div>
	</div>
</div>

{% endblock %}
{% block head_js %}
{{ super() }}
<script>
    $(function() {

        url = "{{ url_for('ViewData.get_annotations') }}?sample_id={{ data.sample.id }}";
        var displayTable = null;

        var jqxhr = $.get(url, function( data ) {

            displayTable = $("#table_data").DataTable({
            	/*"columnDefs": [
            	    { "width": "2%", "targets": [9] }
            	  ],*/

                autoWidth: false,
                data: data.table_data,
                columns: data.columns,
                pageLength:50,
                dom: 'lBfrtip',
                buttons: [ {
                    extend: 'collection',
                    text: 'Export',
                    className: 'btn btn-default',
                    buttons: [
                        'copy',
                        'excel',
                        'csv',
                        {
                            extend: 'pdf',
                            orientation : 'landscape',
                            pageSize : 'A3',
                            title: $('h1').text(),
                            exportOptions: {
                                columns: ':not(.no-print)'
                            }
                        },
                        'print'
                    ]
                }]
            });
        });
        jqxhr.fail(function(data) {
            console.log(JSON.stringify(data));
        });
        jqxhr.always(function() {
            if ( displayTable != null ) {
                displayTable.order( [ 0, 'desc' ] ).draw();
            }
        });


    });


</script>
{% endblock %}
